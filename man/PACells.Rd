% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/PACells.R
\name{PACells}
\alias{PACells}
\title{PACells: identify clinical phenotype-associated cell states from Single-cell ATAC-seq Data}
\usage{
PACells(
  sc_dataset,
  bulk_dataset,
  phenotype,
  motifs,
  cutoff = 0.1,
  screenRatio = 0.8,
  family = c("binomial", "gaussian", "cox")[1],
  method = c("KL", "Pearson", "Spearman")[1],
  level = TRUE,
  sc_refgenome = c("hg38", "hg19")[1],
  bulk_refgenome = c("hg38", "hg19")[1],
  res = 1,
  dims_Neighbors = 2:30,
  dims_UMAP = 2:30,
  group = NULL,
  auto_subsample = 0.7,
  auto_stab_threshold = 0.7,
  batch = c("none", "harmony", "seurat")[1],
  Batch_variable = "Sample",
  dim_Batch = 2:30
)
}
\arguments{
\item{sc_dataset}{A Seurat object containing single-cell ATAC-seq data. It should include an ATAC assay
(default \code{"ATAC"}) with counts and genomic ranges.}

\item{bulk_dataset}{A Seurat object containing bulk ATAC-seq samples in the same feature space.}

\item{phenotype}{Phenotype annotation for bulk samples.
\itemize{
  \item For \code{family = "binomial"} or \code{"gaussian"}: a vector with length equal to the number of
  bulk samples.
  \item For \code{family = "cox"}: a two-column matrix/data.frame where the first column is survival time
  and the second column is event status, with rows aligned to bulk samples.
}}

\item{motifs}{TF motif definitions used by PACells (e.g., obtained from \code{getMotifs()}), provided as
a motif collection compatible with the motif processing steps in the pipeline.}

\item{cutoff}{Cutoff for the percentage of the PACells selected cells in total cells. This parameter is used to
restrict the number of the PACells selected cells. A smaller cutoff value (default \code{10\%}) is recommended
depending on the input data. Users can adjust it based on dataset size and the desired specificity.}

\item{screenRatio}{Pre-screen candidate cells that are strongly related to the phenotype.
This parameter is used to pre-screen the percentage of candidate cells based Bcor measure.
If a numeric value is provided, it directly indicates the
proportion of cells to keep (default \code{0.80}). If \code{"auto"} is used, PACells will select
a suitable proportion by checking whether the pre-screening results remain stable under repeated
subsampling of bulk samples (controlled by auto_subsample and auto_stab_threshold).}

\item{family}{Response type for the regression model. It depends on the type of the given phenotype.
\code{"gaussian"} for continuous outcomes, \code{"binomial"} for binary outcomes, and \code{"cox"} for
survival outcomes.}

\item{method}{Method for calculating the similarity matrix of bulk and single cells.
Options include \code{"KL"}, \code{"Pearson"}, and \code{"Spearman"}. The default is KL divergence.}

\item{level}{Logical value. If TRUE, calculating similarity based on an overall activity level profile.
If FALSE, calculating similarity based on relative activity patterns between features. The default is TRUE.}

\item{sc_refgenome}{Reference genome for sc_dataset ("hg38" or "hg19"), used to
interpret genomic coordinates during motif-related processing.}

\item{bulk_refgenome}{A reference genome for bulk ATAC-seq data("hg38" or "hg19"), used to
interpret genomic coordinates during motif-related processing.}

\item{res}{the resolution parameter (default 1) in the FindClusters function, which is used to group cells.}

\item{dims_Neighbors}{Dimensions of reduction to construct nearest-neighbor graph.}

\item{dims_UMAP}{Dimensions used to compute UMAP embedding.}

\item{group}{A vector of grouping information of single cells, when is provided by the user, is not calculated by the Signac package.
The vector should be aligned with cells in \code{sc_dataset} (by order or by names).}

\item{auto_subsample}{Subsampling proportion of bulk samples used by the adaptive
candidate pre-screening strategy when \code{screenRatio = "auto"}.
The default is \code{0.7}.}

\item{auto_stab_threshold}{Stability threshold used by \code{screenRatio = "auto"} to select
  the smallest candidate ratio with stable pre-screening results across subsamples.
  The default is \code{0.7}.
  @param batch Batch correction option applied to the scATAC-seq data.
Supported options:
\itemize{
  \item \code{"none"}: no batch correction (default).
  \item \code{"harmony"}: Harmony integration on the LSI reduction.
  \item \code{"seurat"}: Seurat reciprocal-LSI anchor-based integration (\code{integrated_lsi}).
}
In our practice, we do not enforce batch correction by default, because many scATAC-seq datasets are
generated within a single study/batch and unnecessary correction may risk over-correcting and weakening
genuine biological signals. When batch effects are evident (e.g., UMAP shows batch-driven separation or
the data combine multiple studies/platforms/labs), we recommend using \code{batch = "harmony"}.
Across our additional comparisons, Harmony typically improved or matched identification performance
under pronounced cross-study heterogeneity, while keeping results broadly consistent when batch effects
were weak, providing a favorable balance between mitigating batch-driven structure and preserving
biological signals.}

\item{Batch_variable}{Metadata column name in \code{sc_dataset@meta.data} indicating batch/sample IDs
used by \code{batch = "harmony"} or \code{batch = "seurat"}. Default is \code{"Sample"}.
Users should ensure this column exists and correctly represents batch structure.}

\item{dim_Batch}{Dimensions used for batch correction (Harmony/Seurat integration).}
}
\value{
A Seurat object containing PACells results. In particular, \code{sc_dataset@meta.data$PACells_label}
is added (levels: "PACells" and "Background"), along with any
results generated during the run when applicable.
}
\description{
\code{PACells} links bulk-level clinical phenotypes (e.g., case/control status, quantitative traits,
prognosis, treatment response, or survival outcomes) to single-cell ATAC-seq profiles and identifies
a subset of cells whose chromatin accessibility patterns are most associated with the given phenotype.
The function returns a Seurat object in which each cell is labeled as \code{"PACells"} or
\code{"Background"} in the metadata.
}
