% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/PACells.R
\name{PACells.RNA}
\alias{PACells.RNA}
\title{PACells.RNA: identify clinical phenotype-associated cell states from scRNA-seq data using bulk phenotypes}
\usage{
PACells.RNA(
  sc_dataset,
  bulk_dataset,
  phenotype,
  cutoff = 0.1,
  screenRatio = 0.8,
  family = c("binomial", "gaussian", "cox")[1],
  method = c("KL", "Pearson", "Spearman")[1],
  level = TRUE,
  res = 1,
  dims_Neighbors = 1:30,
  dims_UMAP = 1:30,
  group = NULL,
  auto_subsample = 0.7,
  auto_stab_threshold = 0.7,
  batch = c("none", "harmony", "seurat")[1],
  Batch_variable = "Sample",
  dim_Batch = 1:30
)
}
\arguments{
\item{sc_dataset}{A gene-by-cell expression matrix for single-cell RNA-seq data.
Rows are genes and columns are single cells. Row names should be gene symbols/IDs.}

\item{bulk_dataset}{A gene-by-sample expression matrix for bulk RNA-seq data.
Rows are genes and columns are bulk samples.}

\item{phenotype}{Phenotype annotation for bulk samples.
\itemize{
  \item For \code{family = "binomial"} and \code{family = "gaussian"}: a vector with length equal to the
  number of bulk samples, aligned to \code{colnames(bulk_dataset)}.
  \item For \code{family = "cox"}: a two-column matrix/data.frame with \code{time} and \code{status},
  aligned to bulk samples.
}}

\item{cutoff}{cutoff Maximum proportion of cells labeled as \code{"PACells"} among all single cells.
This parameter restricts the final number of selected cells. A smaller cutoff value (default \code{10\%}) is recommended
depending on the input data. Users can adjust it depending on dataset size and desired strictness.}

\item{screenRatio}{Pre-screen candidate cells that are strongly related to the phenotype.
This parameter is used to pre-screen the percentage of candidate cells based Bcor measure.
If a numeric value is provided, it directly specifies the proportion of cells to keep (default \code{0.80}).
An appropriate ratio (default \code{80\%}) is recommended depending on the input data.
If \code{screenRatio = "auto"}, PACells selects a suitable proportion by checking the stability of the
pre-screening results under repeated subsampling of bulk samples (controlled by \code{auto_subsample} and
\code{auto_stab_threshold}).}

\item{family}{Response type for the regression model. It depends on the type of the given phenotype and
can be \code{family = gaussian} for linear regression, \code{family = binomial} for classification,
or \code{family = cox} for Cox regression.}

\item{method}{Method for calculating the similarity matrix of bulk and single cells.
#' Options include \code{"KL"}, \code{"Pearson"}, and \code{"Spearman"}. The default is KL divergence.}

\item{level}{Logical value. If TRUE, calculating similarity based on an overall expression level profile.
If FALSE, calculating similarity based on relative expression patterns between features. The default is TRUE.}

\item{res}{the resolution parameter (default 1) in the FindClusters function, which is used to group cells.}

\item{dims_Neighbors}{Dimensions of reduction to construct nearest-neighbor graph.}

\item{dims_UMAP}{Dimensions of reduction to UMAP.}

\item{group}{Optional user-provided grouping vector for single cells. A vector of grouping information of
single cells, when is provided by the user, this grouping is used instead of clusters computed internally.}

\item{auto_subsample}{Subsampling proportion of bulk samples used when \code{screenRatio = "auto"}.
Default is \code{0.7}.}

\item{auto_stab_threshold}{Stability threshold used when \code{screenRatio = "auto"}.
Default is \code{0.7}.}

\item{batch}{Batch correction option applied to the scRNA-seq preprocessing step.
Supported options:
\itemize{
  \item \code{"none"}: no batch correction (default).
  \item \code{"harmony"}: Harmony integration applied after PCA.
  \item \code{"seurat"}: Seurat anchor-based integration (integrated assay followed by PCA).
}
When batch effects are evident (e.g., cells separate by sample/study in uncorrected embeddings or data are
combined across studies/platforms), we recommend using \code{batch = "harmony"}, which often provides a good
balance between mitigating batch-driven structure and preserving biological signal.}

\item{Batch_variable}{Metadata column name in the internally created Seurat object indicating sample/batch IDs
used by \code{batch = "harmony"} or \code{batch = "seurat"}. Default is \code{"Sample"}.
If batch correction is used, users should ensure this variable is available for cells
externally and disable batch correction).}

\item{dim_Batch}{Dimensions used for batch correction (Harmony/Seurat integration).}
}
\value{
This function returns a Seurat-class object. It contains the results that cell state identified by PACells as strongly associated with the clinical phenotype.
A Seurat object created from \code{sc_dataset} with an additional metadata column \code{PACells_label}
(levels: \code{"PACells"} and \code{"Background"}). Cells labeled \code{"PACells"} are the subset identified as
most associated with the bulk phenotype.
}
\description{
\code{PACells.RNA} applies the PACells workflow to transcriptomic data. It links a phenotype defined on
bulk RNA-seq samples (e.g., case/control status, a continuous clinical variable, treatment response, or
survival outcome) to single-cell RNA-seq profiles and identifies a subset of cells most associated with
the bulk phenotype.
}
\details{
The function expects two expression matrices (bulk and single-cell) and returns a Seurat object created
from the single-cell matrix with an additional metadata column PACells_label that labels each cell
as \code{"PACells"} or \code{"Background"}.

\strong{Input requirements and alignment:}
\itemize{
  \item \code{sc_dataset} must be a gene-by-cell expression matrix (rows = genes, columns = cells).
  \item \code{bulk_dataset} must be a gene-by-sample expression matrix (rows = genes, columns = bulk samples).
  \item Row names (genes) are used to match bulk and single-cell data. Only shared genes are used.
  \item \code{phenotype} must be aligned to \code{colnames(bulk_dataset)} (same order).
}

\strong{Workflow summary (high-level):}
\itemize{
  \item Construct a bulk-to-cell similarity matrix using the shared genes.
  \item Pre-screen a subset of candidate cells for efficiency and stability.
  \item Build a Seurat object from the single-cell matrix, perform standard RNA preprocessing and
  clustering/embedding (optionally with batch correction).
  \item Label phenotype-associated cells (\code{"PACells"}).
}
}
